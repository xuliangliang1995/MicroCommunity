<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="commodityStockpileServiceDaoImpl">

    <!-- 保存商品库存信息 add by wuxw 2018-07-03 -->
       <insert id="saveBusinessCommodityStockpileInfo" parameterType="Map">
           insert into business_commodity_stockpile(
amount,operate,stockpile_id,remark,commodity_id,b_id,version,user_id
) values (
#{amount},#{operate},#{stockpileId},#{remark},#{commodityId},#{bId},#{version},#{userId}
)
       </insert>


       <!-- 查询商品库存信息（Business） add by wuxw 2018-07-03 -->
       <select id="getBusinessCommodityStockpileInfo" parameterType="Map" resultType="Map">
           select  t.amount,t.operate,t.stockpile_id,t.stockpile_id stockpileId,t.remark,t.commodity_id,t.commodity_id commodityId,t.b_id,t.b_id bId,t.version,t.user_id,t.user_id userId 
            from business_commodity_stockpile t
            where 1 =1
            <if test="amount !=null and amount != ''">
               and t.amount= #{amount}
            </if>
            <if test="operate !=null and operate != ''">
               and t.operate= #{operate}
            </if>
            <if test="stockpileId !=null and stockpileId != ''">
               and t.stockpile_id= #{stockpileId}
            </if>
            <if test="remark !=null and remark != ''">
               and t.remark= #{remark}
            </if>
            <if test="commodityId !=null and commodityId != ''">
               and t.commodity_id= #{commodityId}
            </if>
            <if test="bId !=null and bId != ''">
               and t.b_id= #{bId}
            </if>
            <if test="version !=null and version != ''">
               and t.version= #{version}
            </if>
            <if test="userId !=null and userId != ''">
               and t.user_id= #{userId}
            </if>

       </select>

    <select id="getCommodityStockpile" resultType="Map" parameterType="string">
        select  t.amount,t.operate,t.stockpile_id,t.stockpile_id stockpileId,t.remark,t.commodity_id,t.commodity_id commodityId,t.b_id,t.b_id bId,t.version,t.user_id,t.user_id userId
            from business_commodity_stockpile t
            where t.commodity_id = #{commodityId}
    </select>




    <!-- 保存商品库存信息至 instance表中 add by wuxw 2018-07-03 -->
    <insert id="saveCommodityStockpileInfoInstance" parameterType="Map">
        insert into commodity_stockpile(
amount,stockpile_id,status_cd,remark,commodity_id,b_id,version,user_id
) select t.amount,t.stockpile_id,'0',t.remark,t.commodity_id,t.b_id,t.version,t.user_id from business_commodity_stockpile t where 1=1
<if test="amount !=null and amount != ''">
   and t.amount= #{amount}
</if> 
   and t.operate= 'ADD'
<if test="stockpileId !=null and stockpileId != ''">
   and t.stockpile_id= #{stockpileId}
</if> 
<if test="remark !=null and remark != ''">
   and t.remark= #{remark}
</if> 
<if test="commodityId !=null and commodityId != ''">
   and t.commodity_id= #{commodityId}
</if> 
<if test="bId !=null and bId != ''">
   and t.b_id= #{bId}
</if> 
<if test="version !=null and version != ''">
   and t.version= #{version}
</if> 
<if test="userId !=null and userId != ''">
   and t.user_id= #{userId}
</if> 

    </insert>



    <!-- 查询商品库存信息 add by wuxw 2018-07-03 -->
    <select id="getCommodityStockpileInfo" parameterType="Map" resultType="Map">
        select  t.amount,t.stockpile_id,t.stockpile_id stockpileId,t.status_cd,t.status_cd statusCd,t.remark,t.commodity_id,t.commodity_id commodityId,t.b_id,t.b_id bId,t.version,t.user_id,t.user_id userId 
from commodity_stockpile t 
where 1 =1 
<if test="amount !=null and amount != ''">
   and t.amount= #{amount}
</if> 
<if test="stockpileId !=null and stockpileId != ''">
   and t.stockpile_id= #{stockpileId}
</if> 
<if test="statusCd !=null and statusCd != ''">
   and t.status_cd= #{statusCd}
</if> 
<if test="remark !=null and remark != ''">
   and t.remark= #{remark}
</if> 
<if test="commodityId !=null and commodityId != ''">
   and t.commodity_id= #{commodityId}
</if> 
<if test="bId !=null and bId != ''">
   and t.b_id= #{bId}
</if> 
<if test="version !=null and version != ''">
   and t.version= #{version}
</if> 
<if test="userId !=null and userId != ''">
   and t.user_id= #{userId}
</if> 
order by t.create_time desc
<if test="page != -1 and page != null ">
   limit #{page}, #{row}
</if> 

    </select>




    <!-- 修改商品库存信息 add by wuxw 2018-07-03 -->
    <update id="updateCommodityStockpileInfoInstance" parameterType="Map">
        update  commodity_stockpile t set t.status_cd = #{statusCd}
        <if test="newBId != null and newBId != ''">
        ,t.b_id = #{newBId}
        </if>
        <if test="amount !=null and amount != ''">
        , t.amount= #{amount}
        </if>
        <if test="remark !=null and remark != ''">
        , t.remark= #{remark}
        </if>
        <if test="commodityId !=null and commodityId != ''">
        , t.commodity_id= #{commodityId}
        </if>
        <if test="version !=null and version != ''">
        , t.version= #{version}
        </if>
        <if test="userId !=null and userId != ''">
        , t.user_id= #{userId}
        </if>
         where 1=1 <if test="stockpileId !=null and stockpileId != ''">
        and t.stockpile_id= #{stockpileId}
        </if>
        <if test="bId !=null and bId != ''">
        and t.b_id= #{bId}
        </if>
         and t.version = #{version} - 1

    </update>

    <!-- 查询商品库存数量 add by wuxw 2018-07-03 -->
     <select id="queryCommodityStockpilesCount" parameterType="Map" resultType="Map">
        select  count(1) count 
from commodity_stockpile t 
where 1 =1 
<if test="amount !=null and amount != ''">
   and t.amount= #{amount}
</if> 
<if test="stockpileId !=null and stockpileId != ''">
   and t.stockpile_id= #{stockpileId}
</if> 
<if test="statusCd !=null and statusCd != ''">
   and t.status_cd= #{statusCd}
</if> 
<if test="remark !=null and remark != ''">
   and t.remark= #{remark}
</if> 
<if test="commodityId !=null and commodityId != ''">
   and t.commodity_id= #{commodityId}
</if> 
<if test="bId !=null and bId != ''">
   and t.b_id= #{bId}
</if> 
<if test="version !=null and version != ''">
   and t.version= #{version}
</if> 
<if test="userId !=null and userId != ''">
   and t.user_id= #{userId}
</if> 


     </select>

</mapper>
